
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MRtrix3Tissue &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/diffusion_imaging/mrtrix3tissue';</script>
    <link rel="canonical" href="https://neurodesk.org/edu/examples/diffusion_imaging/mrtrix3tissue.html" />
    <link rel="icon" href="../../_static/neurodesk_logo.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Electrophysiology" href="../electrophysiology/intro.html" />
    <link rel="prev" title="MRtrix: Part 3" href="MRtrix_3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/neurodesk_logo.svg" class="logo__image only-light" alt="Neurodesk - Home"/>
    <script>document.write(`<img src="../../_static/neurodesk_logo.svg" class="logo__image only-dark" alt="Neurodesk - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../intro.html">Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="intro.html">Diffusion Imaging</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="DIPY_1.html">Basic Tracking with DIPY</a></li>
<li class="toctree-l3"><a class="reference internal" href="DIPY_2.html">Advanced Tracking with DIPY</a></li>
<li class="toctree-l3"><a class="reference internal" href="Diffusion_TBSS_Demo.html">TBSS Tutorial</a></li>


<li class="toctree-l3"><a class="reference internal" href="MRtrix_1.html">MRtrix: Part 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_2.html">MRtrix: Part 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_3.html">MRtrix: Part 3</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">MRtrix3Tissue</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../electrophysiology/intro.html">Electrophysiology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../electrophysiology/eeg_with_mne.html">EEG Analysis with MNE</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../functional_imaging/intro.html">Functional Imaging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/AFNI_preprocessing_only.html">AFNI Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/AFNI_preprocessing_plus_glm.html">AFNI Preprocessing and GLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/AFNI_preprocessing_plus_glm_group.html">AFNI Preprocessing &amp; Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/AFNI_processing_task_based.html">Processing task-based FMRI with AFNI and afni_proc.py</a></li>



<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/FSL_preproc_glm.html">FSL Preprocessing and GLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/FSLnets_course_practical.html">Resting state with FSLnets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/NiWrap.html">NiWrap and Connectome Workbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/aslprep.html">ASLprep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/deepretinotopy.html">DeepRetinotopy Toolbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/first_and_second_level_spm.html">Nipype-SPM fMRI Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/fmriprep.html">fMRIprep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/fsl_all_levels_flanker_nipype.html">Nipype-FSL fMRI Analysis</a></li>



<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/intro_to_preprocessing.html">Introduction to Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/mri_vol2surf.html">FreeSurfer: mri_vol2surf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functional_imaging/process_five_echo_dataset.html">tedana: TE Dependent ANAlysis</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../spectroscopy/intro.html">Spectroscopy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../spectroscopy/lcmodel.html">MR Spectroscopy with LCModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spectroscopy/osprey.html">MR Spectroscopy with Osprey</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../structural_imaging/intro.html">Structural Imaging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/FSL_course_bet.html">FSL course - BET</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/brain_extraction_different_tools.html">Brain Extraction Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/freesurfer-recon-all-clinical.html">FreeSurfer: recon-all-clinical</a></li>

<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/freesurfer.html">FreeSurfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/qsmxt.html">QSMxT</a></li>







<li class="toctree-l3"><a class="reference internal" href="../structural_imaging/sct_toolbox.html">SCT Toolbox</a></li>

</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../workflows/intro.html">Workflows</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../workflows/AA_Neurodesk_demo_tour.html">Neurodesk Tools Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/MRIQC.html">MRIQC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/PyBIDS.html">PyBIDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/RISE_slideshow.html">RISE Slideshow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/bids_conversion.html">BIDS conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/nipype_full.html">Nipype on Neurodesk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/nipype_short.html">Basic Nipype</a></li>

<li class="toctree-l3"><a class="reference internal" href="../workflows/papermill-slurm-submission-example.html">Papermill Slurm Job Submission</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/pydra_preproc_ants.html">Pydra</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/intro.html">Tutorials</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/electrophysiology/intro.html">Electrophysiology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/electrophysiology/EEG_mne-python.html">Analysing EEG Data with MNE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/electrophysiology/fieldtrip.html">Analysing M/EEG Data with FieldTrip</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/functional_imaging/intro.html">Functional Imaging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/connectomeWorkbench.html">Connectome Workbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/fmriprep.html">Using fmriprep with neurodesk on an HPC</a></li>


<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/mriqc.html">Using mriqc with neurodesk on HPC</a></li>


<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/physio.html">PhysIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/physio_batch_workflow.html">A batch scripting example for PhysIO toolbox</a></li>




<li class="toctree-l3"><a class="reference internal" href="../../tutorials/functional_imaging/spm.html">Statistical Parametric Mapping (SPM)</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/multimodal_imaging/intro.html">Multimodal Imaging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/multimodal_imaging/MFCSC.html">Using MFCSC</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/open_data/intro.html">Open Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/open_data/datalad.html">datalad</a></li>


<li class="toctree-l3"><a class="reference internal" href="../../tutorials/open_data/osfclient.html">osfclient</a></li>



</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/phase_processing/intro.html">Phase Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/phase_processing/qsm.html">Quantitative Susceptibility Mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/phase_processing/swi.html">SWI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/phase_processing/unwrapping.html">Unwrapping</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/programming/intro.html">Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/programming/conda.html">Conda environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/programming/matlab.html">Matlab</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/reproducibility/intro.html">Reproducibility</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/reproducibility/datalad-run.html">Reproducible script execution with DataLad</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/spectroscopy/intro.html">Spectroscopy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/spectroscopy/lcmodel.html">Spectroscopy with lcmodel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/spectroscopy/mrsiproc.html">Spectroscopy pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorials/structural_imaging/intro.html">Structural Imaging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/structural_imaging/freesurfer.html">FreeSurfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/structural_imaging/structuralconnectivity.html">Structural connectivity dMRI</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../contribute/intro.html">Contribute</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/examples.html">Contribute Example Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/tutorials.html">Contribute Tutorials</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://play-america.neurodesk.org/hub/user-redirect/git-pull?repo=https%3A//github.com/neurodesk/neurodeskedu&urlpath=lab/tree/neurodeskedu/books/examples/diffusion_imaging/mrtrix3tissue.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Run in America"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Run in America logo" src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">Run in America</span>
</a>
</li>
      
      
      
      
      <li><a href="https://play-europe.neurodesk.org/hub/user-redirect/git-pull?repo=https%3A//github.com/neurodesk/neurodeskedu&urlpath=lab/tree/neurodeskedu/books/examples/diffusion_imaging/mrtrix3tissue.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Run in Europe"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Run in Europe logo" src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">Run in Europe</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/examples/diffusion_imaging/mrtrix3tissue.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MRtrix3Tissue</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-and-resources">Citation and Resources:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-included-in-this-workflow">Tools included in this workflow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-software-tools-and-import-python-libraries">Load software tools and import python libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-mif-file">Convert to .mif file</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#denoising-and-gibbs-ringing-removal-unringing">Denoising and Gibbs ringing removal (“unringing”)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-and-distortion-correction">Motion and distortion correction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-field-correction">Bias field correction</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brain-mask-estimation">Brain mask estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-response-function-estimation">3-tissue response function estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upsampling">Upsampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-csd-modelling">3-tissue CSD modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-bias-field-and-intensity-normalisation">3-tissue bias field and intensity normalisation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-computation">Temperature computation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-csf-mask">Get CSF mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-diffusion-coefficient-in-csf">Calculate diffusion coefficient in CSF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-estimation">Temperature estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="mrtrix3tissue">
<h1>MRtrix3Tissue<a class="headerlink" href="#mrtrix3tissue" title="Link to this heading">#</a></h1>
<p><strong>Authors:</strong> Thuy Dao, Monika Doerig</p>
<p><strong>Date</strong>: 18 Nov 2024</p>
<section id="citation-and-resources">
<h2>Citation and Resources:<a class="headerlink" href="#citation-and-resources" title="Link to this heading">#</a></h2>
<section id="tools-included-in-this-workflow">
<h3>Tools included in this workflow<a class="headerlink" href="#tools-included-in-this-workflow" title="Link to this heading">#</a></h3>
<p><strong>MRtrix3Tissue</strong>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://3tissue.github.io/about.html">MRtrix3Tissue</a>, a fork of <strong>MRtrix3</strong> (Tournier et al. 2019)</p></li>
<li><p>Tournier, J.-D., Smith, R., Raffelt, D., Tabbara, R., Dhollander, T., Pietsch, M., Christiaens, D., Jeurissen, B., Yeh, C.-H., &amp; Connelly, A. (2019). MRtrix3: A fast, flexible and open software framework for medical image processing and visualisation. NeuroImage, 202, 116137. <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2019.116137">https://doi.org/10.1016/j.neuroimage.2019.116137</a></p></li>
</ul>
</section>
<section id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Link to this heading">#</a></h3>
<p><strong>Dataset from OpenNeuro:</strong> BTC_postop</p>
<ul class="simple">
<li><p>Hannelore Aerts and Daniele Marinazzo (2022). BTC_postop. OpenNeuro. [Dataset] doi: <a class="reference external" href="https://openneuro.org/datasets/ds002080/versions/4.0.0">doi:10.18112/openneuro.ds002080.v4.0.0</a></p></li>
</ul>
</section>
</section>
<section id="load-software-tools-and-import-python-libraries">
<h2>Load software tools and import python libraries<a class="headerlink" href="#load-software-tools-and-import-python-libraries" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">nibabel</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">module</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mrtrix3tissue/5.2.8&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mrtrix3tissue/5.2.8&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Link to this heading">#</a></h2>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download data</span>
<span class="o">!</span>datalad<span class="w"> </span>install<span class="w"> </span>https://github.com/OpenNeuroDatasets/ds002080.git
<span class="o">!</span><span class="nb">cd</span><span class="w"> </span>ds002080<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>datalad<span class="w"> </span>get<span class="w"> </span>sub-CON02
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cloning:   0%|                             | 0.00/2.00 [00:00&lt;?, ? candidates/s]
Enumerating: 0.00 Objects [00:00, ? Objects/s]
                                              
Counting:   0%|                              | 0.00/20.6k [00:00&lt;?, ? Objects/s]
                                                                                
Compressing:   0%|                           | 0.00/12.7k [00:00&lt;?, ? Objects/s]
                                                                                
Receiving:   0%|                             | 0.00/22.6k [00:00&lt;?, ? Objects/s]
Receiving:  60%|████████████▌        | 13.5k/22.6k [00:00&lt;00:00, 133k Objects/s]
                                                                                
Resolving:   0%|                              | 0.00/5.65k [00:00&lt;?, ? Deltas/s]
[INFO   ] scanning for unlocked files (this may take some time)                 
[INFO   ] Remote origin not usable by git-annex; setting annex-ignore 
<span class=" -Color -Color-Bold">install</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/ds002080 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">dataset</span>)
Total:   0%|                                   | 0.00/97.7M [00:00&lt;?, ? Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   0%|            | 0.00/8.06M [00:00&lt;?, ? Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   0%|    | 33.3k/8.06M [00:00&lt;00:26, 307k Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   1%|    | 68.1k/8.06M [00:00&lt;00:25, 316k Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   2%|     | 173k/8.06M [00:00&lt;00:12, 614k Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   4%|▏   | 347k/8.06M [00:00&lt;00:07, 1.01M Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:   9%|▎   | 712k/8.06M [00:00&lt;00:03, 1.86M Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:  18%|▌  | 1.44M/8.06M [00:00&lt;00:01, 3.54M Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:  36%|█  | 2.91M/8.06M [00:00&lt;00:00, 6.83M Bytes/s]
Get sub-CON0 .. p_T1w.nii.gz:  65%|█▉ | 5.23M/8.06M [00:00&lt;00:00, 11.5M Bytes/s]
Total:   8%|██▏                       | 8.06M/97.7M [00:04&lt;00:51, 1.75M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:   0%|            | 0.00/48.5M [00:00&lt;?, ? Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:   5%|▏  | 2.32M/48.5M [00:00&lt;00:04, 10.8M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:   9%|▎  | 4.50M/48.5M [00:00&lt;00:02, 14.8M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  14%|▍  | 6.88M/48.5M [00:00&lt;00:02, 17.5M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  19%|▌  | 9.20M/48.5M [00:00&lt;00:02, 18.9M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  23%|▋  | 11.2M/48.5M [00:00&lt;00:01, 18.9M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  28%|▊  | 13.7M/48.5M [00:00&lt;00:01, 20.3M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  33%|▉  | 16.0M/48.5M [00:00&lt;00:01, 20.6M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  38%|█▏ | 18.3M/48.5M [00:00&lt;00:01, 20.7M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  43%|█▎ | 20.7M/48.5M [00:01&lt;00:01, 21.1M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  48%|█▍ | 23.0M/48.5M [00:01&lt;00:01, 21.4M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  52%|█▌ | 25.4M/48.5M [00:01&lt;00:01, 21.6M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  57%|█▋ | 27.7M/48.5M [00:01&lt;00:00, 21.6M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  62%|█▊ | 30.1M/48.5M [00:01&lt;00:00, 21.6M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  67%|██ | 32.5M/48.5M [00:01&lt;00:00, 21.7M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  72%|██▏| 34.7M/48.5M [00:01&lt;00:00, 21.3M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  76%|██▎| 37.0M/48.5M [00:01&lt;00:00, 21.4M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  81%|██▍| 39.2M/48.5M [00:01&lt;00:00, 21.5M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  86%|██▌| 41.5M/48.5M [00:02&lt;00:00, 22.1M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  91%|██▋| 43.9M/48.5M [00:02&lt;00:00, 22.5M Bytes/s]
Get sub-CON0 .. P_dwi.nii.gz:  98%|██▉| 47.7M/48.5M [00:02&lt;00:00, 20.8M Bytes/s]
Total:  58%|███████████████           | 56.5M/97.7M [00:07&lt;00:05, 7.54M Bytes/s]
Get sub-CON0 .. A_dwi.nii.gz:   0%|            | 0.00/1.18M [00:00&lt;?, ? Bytes/s]
                                                                                
Get sub-CON0 .. _bold.nii.gz:   0%|            | 0.00/40.0M [00:00&lt;?, ? Bytes/s]
Get sub-CON0 .. _bold.nii.gz:   4%|▏  | 1.73M/40.0M [00:00&lt;00:04, 7.95M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  10%|▎  | 3.87M/40.0M [00:00&lt;00:02, 12.9M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  15%|▍  | 5.97M/40.0M [00:00&lt;00:02, 15.3M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  20%|▌  | 8.10M/40.0M [00:00&lt;00:01, 16.9M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  26%|▊  | 10.2M/40.0M [00:00&lt;00:01, 17.9M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  31%|▉  | 12.4M/40.0M [00:00&lt;00:01, 18.8M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  36%|█  | 14.6M/40.0M [00:00&lt;00:01, 19.1M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  42%|█▎ | 16.7M/40.0M [00:00&lt;00:01, 19.6M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  47%|█▍ | 18.8M/40.0M [00:01&lt;00:01, 19.9M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  53%|█▌ | 21.1M/40.0M [00:01&lt;00:00, 20.1M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  58%|█▊ | 23.4M/40.0M [00:01&lt;00:00, 20.3M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  64%|█▉ | 25.6M/40.0M [00:01&lt;00:00, 20.5M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  70%|██ | 27.8M/40.0M [00:01&lt;00:00, 20.6M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  75%|██▎| 30.1M/40.0M [00:01&lt;00:00, 20.8M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  81%|██▍| 32.2M/40.0M [00:01&lt;00:00, 21.0M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  91%|██▋| 36.4M/40.0M [00:01&lt;00:00, 20.9M Bytes/s]
Get sub-CON0 .. _bold.nii.gz:  96%|██▉| 38.5M/40.0M [00:02&lt;00:00, 20.9M Bytes/s]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-CON02/ses-postop/anat/sub-CON02_ses-postop_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-PA_dwi.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-CON02/ses-postop/func/sub-CON02_ses-postop_task-rest_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-CON02 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
action summary:
  get (ok: 5)

</pre></div>
</div>
</div>
</div>
<section id="convert-to-mif-file">
<h3>Convert to .mif file<a class="headerlink" href="#convert-to-mif-file" title="Link to this heading">#</a></h3>
<p>Once data is downloaded, it is recommended to import and store it as .mif file(s), the so-called “MRtrix Image Format”.</p>
<p><code class="docutils literal notranslate"><span class="pre">mrconvert</span></code> is the tool to convert between all sorts of image formats (or extract parts of images or change properties) and enables you to read from e.g. DICOM folders or NIfTI (.nii) images and store an image as a .mif file.</p>
<p>If your diffusion MRI data comes as a NIfTI (.nii) image instead, the gradient orientations and b-values will typically be stored in 2 separate files (a “bvecs” and “bvals” file).</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
mrconvert ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.nii.gz AP.mif -fslgrad ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.bvec ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.bval
mrconvert ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-PA_dwi.nii.gz PA.mif
mrconvert PA.mif -fslgrad ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-PA_dwi.bvec ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-PA_dwi.bval - | mrmath - mean mean_b0_PA.mif -axis 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrconvert: [100%] uncompressing image &quot;ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.nii.gz&quot;?7h?7l
mrconvert: [100%] copying from &quot;ds002080/s...es-postop_acq-AP_dwi.nii.gz&quot; to &quot;AP.mif&quot;?7h?7l?7l?7l?7l?7l
mrconvert: [100%] uncompressing image &quot;ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-PA_dwi.nii.gz&quot;?7h?7l
mrconvert: [100%] copying from &quot;ds002080/s...es-postop_acq-PA_dwi.nii.gz&quot; to &quot;PA.mif&quot;?7h?7l
mrconvert: [100%] copying from &quot;PA.mif&quot; to &quot;/tmp/mrtrix-tmp-wDqyZO.mif&quot;?7h?7l
mrmath: [100%] preloading data for &quot;/tmp/mrtrix-tmp-wDqyZO.mif&quot;?7h
mrmath: [100%] computing mean along axis 3...?7h?7l
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing">
<h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h2>
<p>The following are common preprocessing steps done with MRtrix.</p>
<section id="denoising-and-gibbs-ringing-removal-unringing">
<h3>Denoising and Gibbs ringing removal (“unringing”)<a class="headerlink" href="#denoising-and-gibbs-ringing-removal-unringing" title="Link to this heading">#</a></h3>
<p>The first preprocessing step is denoise the data by using <code class="docutils literal notranslate"><span class="pre">dwidenoise</span></code> command. This requires an input and an output argument, and you also have the option to output the noise map with the <code class="docutils literal notranslate"><span class="pre">-noise</span></code> option.</p>
<p>The next step is to run <code class="docutils literal notranslate"><span class="pre">mrdegibbs</span></code>, which removes Gibbs’ ringing artifacts from the data.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
dwidenoise AP.mif dwi_denoised.mif -noise noise.mif
mrdegibbs dwi_denoised.mif dwi_denoised_unringed.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwidenoise: [100%] preloading data for &quot;AP.mif&quot;?7h?7l?7l?7l?7l?7l?7l
dwidenoise: [ 22%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [ 37%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [ 51%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [ 63%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [ 76%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [ 89%] running MP-PCA denoising... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

dwidenoise: [100%] running MP-PCA denoising?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
mrdegibbs: [ 56%] performing Gibbs ringing removal... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lIOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)

mrdegibbs: [100%] performing Gibbs ringing removal?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
</pre></div>
</div>
</div>
</div>
<p>Next, we extract the b-values from the primary phase-encoded image using <code class="docutils literal notranslate"><span class="pre">dwiextract</span></code>.</p>
<p>If you have also scanned a pair of reverse phase-encoded b=0 images, you can correct for susceptibility-induced EPI distortions by concatenating the reverse phase-encoded b=0 images using <code class="docutils literal notranslate"><span class="pre">mrcat</span></code> to create a new image <code class="docutils literal notranslate"><span class="pre">b0_pair.mif</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwiextract<span class="w"> </span>dwi_denoised.mif<span class="w"> </span>-<span class="w"> </span>-bzero<span class="w"> </span><span class="p">|</span><span class="w"> </span>mrmath<span class="w"> </span>-<span class="w"> </span>mean<span class="w"> </span>mean_b0_AP.mif<span class="w"> </span>-axis<span class="w"> </span><span class="m">3</span>
<span class="o">!</span>mrcat<span class="w"> </span>mean_b0_AP.mif<span class="w"> </span>mean_b0_PA.mif<span class="w"> </span>-axis<span class="w"> </span><span class="m">3</span><span class="w"> </span>b0_pair.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwiextract: [100%] extracting volumes?7h?7l?7l
mrmath: [100%] preloading data for &quot;/tmp/mrtrix-tmp-Ail9FL.mif&quot;?7h?7l
mrmath: [100%] computing mean along axis 3...?7h?7l
mrcat: [100%] concatenating &quot;mean_b0_AP.mif&quot;?7h?7l
mrcat: [100%] concatenating &quot;mean_b0_PA.mif&quot;?7h?7l
</pre></div>
</div>
</div>
</div>
</section>
<section id="motion-and-distortion-correction">
<h3>Motion and distortion correction<a class="headerlink" href="#motion-and-distortion-correction" title="Link to this heading">#</a></h3>
<p>Motion and distortion correction are performed by the <code class="docutils literal notranslate"><span class="pre">dwifslpreproc</span></code> command, most of the heavy lifting is done automatically by FSL’s <code class="docutils literal notranslate"><span class="pre">topup</span></code> and <code class="docutils literal notranslate"><span class="pre">eddy</span></code> tools.</p>
<p><code class="docutils literal notranslate"><span class="pre">-pe_dir</span></code> option is used to tell dwifslpreproc the phase-encoding direction of the scan.</p>
<p><code class="docutils literal notranslate"> <span class="pre">-se_epi</span></code> is an additional image series consisting of spin-echo EPI images used by <code class="docutils literal notranslate"><span class="pre">topup</span></code> for estimating the inhomogeneity field</p>
<p><code class="docutils literal notranslate"><span class="pre">-eddy_options</span></code> is an additional command-line options to the <code class="docutils literal notranslate"><span class="pre">eddy</span></code></p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwifslpreproc<span class="w"> </span>dwi_denoised_unringed.mif<span class="w"> </span>dwi_denoised_unringed_preproc.mif<span class="w"> </span>-pe_dir<span class="w"> </span>AP<span class="w"> </span>-rpe_pair<span class="w"> </span>-se_epi<span class="w"> </span>b0_pair.mif<span class="w">  </span>-eddy_options<span class="w"> </span><span class="s2">&quot; --slm=linear --data_is_shelled&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwifslpreproc: 
dwifslpreproc: <span class=" -Color -Color-Green">Note that this script makes use of commands / algorithms that have relevant articles for citation; INCLUDING FROM EXTERNAL SOFTWARE PACKAGES. Please consult the help page (-help option) for more information.</span>
dwifslpreproc: 
dwifslpreproc: <span class=" -Color -Color-Green">Generated scratch directory: /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/</span>
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi_denoised_unringed.mif /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/dwi.mif -json_export /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/dwi.json
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/b0_pair.mif /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/se_epi.mif
dwifslpreproc: <span class=" -Color -Color-Green">Changing to scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/)</span>
dwifslpreproc: <span class=" -Color -Color-Green">Total readout time not provided at command-line; assuming sane default of 0.1</span>
<span class=" -Color -Color-Cyan">Command:</span>  mrinfo dwi.mif -export_grad_mrtrix grad.b
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert se_epi.mif topup_in.nii -import_pe_table se_epi_manual_pe_scheme.txt -strides -1,+2,+3,+4 -export_pe_table topup_datain.txt
<span class=" -Color -Color-Cyan">Command:</span>  topup --imain=topup_in.nii --datain=topup_datain.txt --out=field --fout=field_map.nii.gz --config=/opt/fsl-6.0.3/etc/flirtsch/b02b0.cnf --verbose
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert dwi.mif -import_pe_table dwi_manual_pe_scheme.txt - | mrinfo - -export_pe_eddy applytopup_config.txt applytopup_indices.txt
<span class=" -Color -Color-Cyan">Command:</span>  dwiextract dwi.mif -import_pe_table dwi_manual_pe_scheme.txt -pe 0.0,-1.0,0.0,0.1 - | mrconvert - dwi_pe_1.nii -json_export dwi_pe_1.json
<span class=" -Color -Color-Cyan">Command:</span>  applytopup --imain=dwi_pe_1.nii --datain=applytopup_config.txt --inindex=1 --topup=field --out=dwi_pe_1_applytopup.nii --method=jac
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert dwi_pe_1_applytopup.nii.gz dwi_pe_1_applytopup.mif -json_import dwi_pe_1.json
<span class=" -Color -Color-Cyan">Command:</span>  dwi2mask dwi_pe_1_applytopup.mif - | maskfilter - dilate - | mrconvert - eddy_mask.nii -datatype float32 -strides -1,+2,+3
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert dwi.mif -import_pe_table dwi_manual_pe_scheme.txt eddy_in.nii -strides -1,+2,+3,+4 -export_grad_fsl bvecs bvals -export_pe_eddy eddy_config.txt eddy_indices.txt
<span class=" -Color -Color-Cyan">Command:</span>  eddy_cuda9.1 --imain=eddy_in.nii --mask=eddy_mask.nii --acqp=eddy_config.txt --index=eddy_indices.txt --bvecs=bvecs --bvals=bvals --topup=field --slm=linear --data_is_shelled --out=dwi_post_eddy --verbose
dwifslpreproc: <span class=" -Color -Color-Green">CUDA version of &#39;eddy&#39; was not successful; attempting OpenMP version</span>
<span class=" -Color -Color-Cyan">Command:</span>  eddy_openmp --imain=eddy_in.nii --mask=eddy_mask.nii --acqp=eddy_config.txt --index=eddy_indices.txt --bvecs=bvecs --bvals=bvals --topup=field --slm=linear --data_is_shelled --out=dwi_post_eddy --verbose
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert dwi_post_eddy.nii.gz result.mif -strides -1,2,3,4 -fslgrad dwi_post_eddy.eddy_rotated_bvecs bvals
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert result.mif /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi_denoised_unringed_preproc.mif
dwifslpreproc: <span class=" -Color -Color-Green">Changing back to original directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging)</span>
dwifslpreproc: <span class=" -Color -Color-Green">Deleting scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwifslpreproc-tmp-OMRCOI/)</span>
</pre></div>
</div>
</div>
</div>
<section id="bias-field-correction">
<h4>Bias field correction<a class="headerlink" href="#bias-field-correction" title="Link to this heading">#</a></h4>
<p>You can correct for bias fields at this point in the pipeline with the <code class="docutils literal notranslate"><span class="pre">dwibiascorrect</span> <span class="pre">ants</span></code> command</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwibiascorrect<span class="w"> </span>ants<span class="w"> </span>dwi_denoised_unringed_preproc.mif<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwibiascorrect: 
dwibiascorrect: <span class=" -Color -Color-Green">Note that this script makes use of commands / algorithms that have relevant articles for citation; INCLUDING FROM EXTERNAL SOFTWARE PACKAGES. Please consult the help page (-help option) for more information.</span>
dwibiascorrect: 
dwibiascorrect: <span class=" -Color -Color-Green">Generated scratch directory: /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwibiascorrect-tmp-Y7JHHU/</span>
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi_denoised_unringed_preproc.mif /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwibiascorrect-tmp-Y7JHHU/in.mif
dwibiascorrect: <span class=" -Color -Color-Green">Changing to scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwibiascorrect-tmp-Y7JHHU/)</span>
<span class=" -Color -Color-Cyan">Command:</span>  dwi2mask in.mif mask.mif
<span class=" -Color -Color-Cyan">Command:</span>  dwiextract in.mif - -bzero | mrmath - mean mean_bzero.mif -axis 3
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert mean_bzero.mif mean_bzero.nii -strides +1,+2,+3
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert mask.mif mask.nii -strides +1,+2,+3
<span class=" -Color -Color-Cyan">Command:</span>  N4BiasFieldCorrection -d 3 -i mean_bzero.nii -w mask.nii -o [corrected.nii,init_bias.nii] -s 4 -b [100,3] -c [1000,0.0]
<span class=" -Color -Color-Cyan">Command:</span>  mrcalc mean_bzero.mif mask.mif -mult - | mrmath - sum - -axis 0 | mrmath - sum - -axis 1 | mrmath - sum - -axis 2 | mrdump -
<span class=" -Color -Color-Cyan">Command:</span>  mrcalc corrected.nii mask.mif -mult - | mrmath - sum - -axis 0 | mrmath - sum - -axis 1 | mrmath - sum - -axis 2 | mrdump -
<span class=" -Color -Color-Cyan">Command:</span>  mrcalc init_bias.nii 0.531319575981 -mult bias.mif
<span class=" -Color -Color-Cyan">Command:</span>  mrcalc in.mif bias.mif -div result.mif
<span class=" -Color -Color-Cyan">Command:</span>  mrconvert result.mif /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi_denoised_unringed_preproc_unbiased.mif
dwibiascorrect: <span class=" -Color -Color-Green">Changing back to original directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging)</span>
dwibiascorrect: <span class=" -Color -Color-Green">Deleting scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwibiascorrect-tmp-Y7JHHU/)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="brain-mask-estimation">
<h3>Brain mask estimation<a class="headerlink" href="#brain-mask-estimation" title="Link to this heading">#</a></h3>
<p>A brain mask can be estimated automatically from the diffusion MRI data using <code class="docutils literal notranslate"><span class="pre">dwi2mask</span></code> as follows:</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwi2mask<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased.mif<span class="w"> </span>dwi_mask.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwi2mask: [100%] preloading data for &quot;dwi_denoised_unringed_preproc_unbiased.mif&quot;?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
dwi2mask: [100%] finding min/max of &quot;mean b=0 image&quot;?7h?7l
dwi2mask: [done] optimising threshold?7h
dwi2mask: [100%] thresholding?7h?7l
dwi2mask: [100%] finding min/max of &quot;mean b=700 image&quot;?7h?7l
dwi2mask: [done] optimising threshold?7h
dwi2mask: [100%] thresholding?7h?7l
dwi2mask: [100%] finding min/max of &quot;mean b=1200 image&quot;?7h?7l
dwi2mask: [done] optimising threshold?7h
dwi2mask: [100%] thresholding?7h?7l
dwi2mask: [100%] finding min/max of &quot;mean b=2800 image&quot;?7h?7l
dwi2mask: [done] optimising threshold?7h
dwi2mask: [100%] thresholding?7h?7l
dwi2mask: [done] computing dwi brain mask?7h?7l?7l
dwi2mask: [done] applying mask cleaning filter?7h
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="decomposition">
<h2>Decomposition<a class="headerlink" href="#decomposition" title="Link to this heading">#</a></h2>
<section id="tissue-response-function-estimation">
<h3>3-tissue response function estimation<a class="headerlink" href="#tissue-response-function-estimation" title="Link to this heading">#</a></h3>
<p>An method to obtain 3-tissue response functions representing single-fibre white matter (WM), grey matter (GM) and CSF from the data itself, is available as the so-called <code class="docutils literal notranslate"><span class="pre">dwi2response</span> <span class="pre">dhollander</span></code> command from <code class="docutils literal notranslate"><span class="pre">MRtrix3Tissue</span></code> package.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwi2response<span class="w"> </span>dhollander<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased.mif<span class="w"> </span>response_wm.txt<span class="w"> </span>response_gm.txt<span class="w"> </span>response_csf.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwi2response: 
dwi2response: <span class=" -Color -Color-Green">Note that this script makes use of commands / algorithms that have relevant articles for citation. Please consult the help page (-help option) for more information.</span>
dwi2response: 
dwi2response: <span class=" -Color -Color-Green">Generated scratch directory: /home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi2response-tmp-5QHWDZ/</span>
dwi2response: <span class=" -Color -Color-Green">Importing DWI data (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi_denoised_unringed_preproc_unbiased.mif)...</span>
dwi2response: <span class=" -Color -Color-Green">Changing to scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi2response-tmp-5QHWDZ/)</span>
dwi2response: <span class=" -Color -Color-Green">Computing brain mask (dwi2mask)...</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">4 unique b-value(s) detected: 0,700,1200,2800 with 6,16,30,50 volumes</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Preparation:</span>
dwi2response: <span class=" -Color -Color-Green">* Eroding brain mask by 3 pass(es)...</span>
dwi2response: <span class=" -Color -Color-Green">  [ mask: 96467 -&gt; 69356 ]</span>
dwi2response: <span class=" -Color -Color-Green">* Computing signal decay metric (SDM):</span>
dwi2response: <span class=" -Color -Color-Green"> * b=0...</span>
dwi2response: <span class=" -Color -Color-Green"> * b=700...</span>
dwi2response: <span class=" -Color -Color-Green"> * b=1200...</span>
dwi2response: <span class=" -Color -Color-Green"> * b=2800...</span>
dwi2response: <span class=" -Color -Color-Green">* Removing erroneous voxels from mask and correcting SDM...</span>
dwi2response: <span class=" -Color -Color-Green">  [ mask: 69356 -&gt; 69356 ]</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Crude segmentation:</span>
dwi2response: <span class=" -Color -Color-Green">* Crude WM versus GM-CSF separation (at FA=0.2)...</span>
dwi2response: <span class=" -Color -Color-Green">  [ 69356 -&gt; 37105 (WM) &amp; 32251 (GM-CSF) ]</span>
dwi2response: <span class=" -Color -Color-Green">* Crude GM versus CSF separation...</span>
dwi2response: <span class=" -Color -Color-Green">  [ 32251 -&gt; 21468 (GM) &amp; 10783 (CSF) ]</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Refined segmentation:</span>
dwi2response: <span class=" -Color -Color-Green">* Refining WM...</span>
dwi2response: <span class=" -Color -Color-Green">  [ WM: 37105 -&gt; 33591 ]</span>
dwi2response: <span class=" -Color -Color-Green">* Refining GM...</span>
dwi2response: <span class=" -Color -Color-Green">  [ GM: 21468 -&gt; 11977 ]</span>
dwi2response: <span class=" -Color -Color-Green">* Refining CSF...</span>
dwi2response: <span class=" -Color -Color-Green">  [ CSF: 10783 -&gt; 5380 ]</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Final voxel selection and response function estimation:</span>
dwi2response: <span class=" -Color -Color-Green">* CSF:</span>
dwi2response: <span class=" -Color -Color-Green"> * Selecting final voxels (10.0% of refined CSF)...</span>
dwi2response: <span class=" -Color -Color-Green">   [ CSF: 5380 -&gt; 538 ]</span>
dwi2response: <span class=" -Color -Color-Green"> * Estimating response function...</span>
dwi2response: <span class=" -Color -Color-Green">* GM:</span>
dwi2response: <span class=" -Color -Color-Green"> * Selecting final voxels (2.0% of refined GM)...</span>
dwi2response: <span class=" -Color -Color-Green">   [ GM: 11977 -&gt; 240 ]</span>
dwi2response: <span class=" -Color -Color-Green"> * Estimating response function...</span>
dwi2response: <span class=" -Color -Color-Green">* single-fibre WM:</span>
dwi2response: <span class=" -Color -Color-Green"> * Selecting final voxels (0.5% of refined WM)...</span>
dwi2response: <span class=" -Color -Color-Green">   [ WM: 33591 -&gt; 168 (single-fibre) ]</span>
dwi2response: <span class=" -Color -Color-Green"> * Estimating response function...</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Generating outputs...</span>
dwi2response: <span class=" -Color -Color-Green">-------</span>
dwi2response: <span class=" -Color -Color-Green">Changing back to original directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging)</span>
dwi2response: <span class=" -Color -Color-Green">Deleting scratch directory (/home/jovyan/Git_repositories/example-notebooks/books/diffusion_imaging/dwi2response-tmp-5QHWDZ/)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="upsampling">
<h3>Upsampling<a class="headerlink" href="#upsampling" title="Link to this heading">#</a></h3>
<p>Upsampling your preprocessed diffusion MRI data before the 3-tissue constrained spherical deconvolution (3-tissue CSD) step to get a higher quality result. Upsampling is useful if you’re after a higher quality visualisation, which reveals finer details using <code class="docutils literal notranslate"><span class="pre">mrgrid</span></code>.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mrgrid<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased.mif<span class="w"> </span>regrid<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased_upsampled.mif<span class="w"> </span>-voxel<span class="w"> </span><span class="m">1</span>.5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrgrid: [ 45%] reslicing &quot;dwi_denoised_unringed_preproc_unbiased.mif&quot;... ?7h?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7l11%] reslicing &quot;dwi_denoised_unringed_preproc_unbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l23%] reslicing &quot;dwi_denoised_unringed_preproc_unbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l
mrgrid: [100%] reslicing &quot;dwi_denoised_unringed_preproc_unbiased.mif&quot;?7h?7l?7l?7l?7lbiased.mif&quot;... ?7h?7lbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7l?7l?7l?7lbiased.mif&quot;... ?7h?7l?7l?7lbiased.mif&quot;... ?7h?7l
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>IOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)
</pre></div>
</div>
</div>
</div>
<p>After upsampling the image, you need to regrid the brain mask to the exact same voxel grid as the image via the <code class="docutils literal notranslate"><span class="pre">-template</span></code> option to <code class="docutils literal notranslate"><span class="pre">mrgrid</span></code>. If the regridding is effectively upsampling, you can avoid jagged edges around masks by performing linear interpolation <code class="docutils literal notranslate"><span class="pre">-interp</span> <span class="pre">linear</span></code>. Then a median filter the result using the <code class="docutils literal notranslate"><span class="pre">maskfilter</span></code> command. To perform all of this at once (without storing an intermediate image), you an directly “pipe” the output of mrgrid into the input of maskfilter, by replacing the output in the one command and the input in the other command by a dash (“-”), and typing a “pipe” (“|”) between both commands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mrgrid<span class="w"> </span>dwi_mask.mif<span class="w"> </span>regrid<span class="w"> </span>-<span class="w"> </span>-template<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased_upsampled.mif<span class="w"> </span>-interp<span class="w"> </span>linear<span class="w"> </span>-datatype<span class="w"> </span>bit<span class="w"> </span><span class="p">|</span><span class="w"> </span>maskfilter<span class="w"> </span>-<span class="w"> </span>median<span class="w"> </span>dwi_mask_upsampled.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrgrid: [100%] reslicing &quot;dwi_mask.mif&quot;?7h?7lng &quot;dwi_mask.mif&quot;... ?7h?7l
maskfilter: [100%] applying median filter to image -?7h?7l?7l?7l
</pre></div>
</div>
</div>
</div>
</section>
<section id="tissue-csd-modelling">
<h3>3-tissue CSD modelling<a class="headerlink" href="#tissue-csd-modelling" title="Link to this heading">#</a></h3>
<p>Your data is now ready for 3-tissue CSD modelling with the previously obtained 3-tissue response functions, which will result in modelling the diffusion MRI data using WM-like (FOD), GM-like and CSF-like compartments. There are 2 different methods (or algorithms) available to perform 3-tissue CSD. The choice between both depends on what (part of your) data you intend to perform 3-tissue CSD modelling for.</p>
<p>If you want to perform 3-tissue CSD modelling for multi-shell data, this can be achieved using the multi-shell multi-tissue CSD (MSMT-CSD) method or algorithm, as follows:</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>dwi2fod<span class="w"> </span>msmt_csd<span class="w"> </span>dwi_denoised_unringed_preproc_unbiased_upsampled.mif<span class="w"> </span>response_wm.txt<span class="w"> </span>wmfod.mif<span class="w"> </span>response_gm.txt<span class="w"> </span>gm.mif<span class="w"> </span>response_csf.txt<span class="w"> </span>csf.mif<span class="w"> </span>-mask<span class="w"> </span>dwi_mask_upsampled.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dwi2fod: [100%] preloading data for &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;?7h?7l?7l.mif&quot;... ?7h?7l?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7ldwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7l?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7l?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7lfor &quot;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&quot;... ?7h?7l?7l
dwi2fod: [  6%] performing multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l
dwi2fod: [ 19%] performing multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
dwi2fod: [ 24%] performing multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
dwi2fod: [100%] performing multi-shell, multi-tissue CSD?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7l?7l?7li-tissue CSD... ?7h?7li-tissue CSD... ?7h?7l?7li-tissue CSD... ?7h?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7lforming multi-shell, multi-tissue CSD... ?7h?7l?7l?7l?7l
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>IOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)
IOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)
IOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)
</pre></div>
</div>
</div>
</div>
</section>
<section id="tissue-bias-field-and-intensity-normalisation">
<h3>3-tissue bias field and intensity normalisation<a class="headerlink" href="#tissue-bias-field-and-intensity-normalisation" title="Link to this heading">#</a></h3>
<p>Bias field correction and global intensity normalisation can be performed using the <code class="docutils literal notranslate"><span class="pre">mtnormalise</span></code> command, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mtnormalise<span class="w"> </span>wmfod.mif<span class="w"> </span>wmfod_norm.mif<span class="w"> </span>gm.mif<span class="w"> </span>gm_norm.mif<span class="w"> </span>csf.mif<span class="w"> </span>csf_norm.mif<span class="w"> </span>-mask<span class="w"> </span>dwi_mask_upsampled.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mtnormalise: [done] loading input images?7h?7l?7l
mtnormalise: [100%] performing log-domain intensity normalisation?7h?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l?7l
mtnormalise: [done] writing output images?7h?7l
mtnormalise: [100%] performing log-domain intensity normalisation
mtnormalise: [done] loading input images
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="temperature-computation">
<h2>Temperature computation<a class="headerlink" href="#temperature-computation" title="Link to this heading">#</a></h2>
<section id="get-csf-mask">
<h3>Get CSF mask<a class="headerlink" href="#get-csf-mask" title="Link to this heading">#</a></h3>
<p>You first need to get 2 CSF masks from 2 criteria:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">csf_mask1.mif</span></code> from CSF spherical harmonic coefficients applying the first criteria (aka the csf.mif file)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">csf_mask2.mif</span></code> from second criteria (note: 0.141047 might be half of max response function)</p></li>
</ul>
<p>Then find the overlap of both masks resulting in the final mask <code class="docutils literal notranslate"><span class="pre">csf_maskcombined.mif</span></code>.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
mrconvert wmfod_norm.mif -coord 3 0 -axes 0,1,2 - | mrcalc csf_norm.mif gm_norm.mif - -add 5 -mult -gt csf_mask1.mif -datatype bit
mrthreshold csf_norm.mif csf_mask2.mif -abs 0.141047
mrcalc csf_mask1.mif csf_mask2.mif -mult csf_maskcombined.mif -datatype bit
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrconvert: [100%] copying from &quot;wmfod_norm.mif&quot; to &quot;/tmp/mrtrix-tmp-7Z4XgQ.mif&quot;?7h?7l
mrcalc: [100%] computing: (csf_norm.mif &gt; ((gm_norm.mif + /tmp/mrtrix-tmp-7Z4XgQ.mif) * 5))?7h?7l
mrthreshold: [100%] Determining and applying per-volume thresholds?7h
mrcalc: [100%] computing: (csf_mask1.mif * csf_mask2.mif)?7h?7l
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-diffusion-coefficient-in-csf">
<h3>Calculate diffusion coefficient in CSF<a class="headerlink" href="#calculate-diffusion-coefficient-in-csf" title="Link to this heading">#</a></h3>
<p>First, we filter the processed image to exclude b-values over 1000 into a new image <code class="docutils literal notranslate"><span class="pre">reduced.mif</span></code>.</p>
<p>Next, estimate the Apparent Diffusion Coefficient (ADC) using <code class="docutils literal notranslate"><span class="pre">dwi2adc</span></code>.</p>
<p>Then we extract the coefficient from the second array in <code class="docutils literal notranslate"><span class="pre">dwi_adc.mif</span></code> to get D values.</p>
<p>Finally, we filter the D values within CSF using generated mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the index of b-values &lt; 1000 from table and write to txt file for next step</span>
<span class="n">bvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;ds002080/sub-CON02/ses-postop/dwi/sub-CON02_ses-postop_acq-AP_dwi.bval&quot;</span><span class="p">)</span>
<span class="n">bvals_filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bvals</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;bval_less_1000.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txt_file</span><span class="p">:</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bvals_filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
mrconvert dwi_denoised_unringed_preproc_unbiased_upsampled.mif reduced.mif -coord 3 $(cat bval_less_1000.txt)
dwi2adc reduced.mif dwi_adc.mif
mrconvert dwi_adc.mif extracted_adc.mif -coord 3 1
mrcalc extracted_adc.mif csf_maskcombined.mif -mult masked_adc.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrconvert: [100%] copying from &quot;dwi_denois...proc_unbiased_upsampled.mif&quot; to &quot;reduced.mif&quot;?7h?7l?7l?7l?7l?7l
dwi2adc: [100%] computing ADC values?7h?7l?7l?7l
mrconvert: [100%] copying from &quot;dwi_adc.mif&quot; to &quot;extracted_adc.mif&quot;?7h?7l
mrcalc: [100%] computing: (extracted_adc.mif * csf_maskcombined.mif)?7h?7l
</pre></div>
</div>
</div>
</div>
</section>
<section id="temperature-estimation">
<h3>Temperature estimation<a class="headerlink" href="#temperature-estimation" title="Link to this heading">#</a></h3>
<p>We calculate the temperature of cerebrospinal ﬂuid (CSF) using the following equation from <a class="reference external" href="https://analyticalsciencejournals.onlinelibrary.wiley.com/doi/10.1002/nbm.1656">this study</a>:</p>
<p>\begin{gather*}
T = \frac{2256.74}{\ln\left(\frac{4.39221}{D}\right)} - 273
\end{gather*}</p>
<p>where D is the diffusion constant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mrcalc<span class="w"> </span><span class="m">2256</span>.74<span class="w"> </span><span class="m">4</span>.39221<span class="w"> </span>masked_adc.mif<span class="w"> </span>-divide<span class="w"> </span>-log<span class="w"> </span>-divide<span class="w"> </span><span class="m">273</span>.15<span class="w"> </span>-subtract<span class="w"> </span>masked_temperature.mif
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mrcalc: [100%] computing: ((2256.74 / log ((4.39221 / masked_adc.mif))) - 273.15)?7h?7l?7l
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># File paths for both images</span>
<span class="n">mif_file_path1</span> <span class="o">=</span> <span class="s1">&#39;dwi_denoised_unringed_preproc_unbiased_upsampled.mif&#39;</span>  
<span class="n">mif_file_path2</span> <span class="o">=</span> <span class="s1">&#39;masked_temperature.mif&#39;</span>          

<span class="c1"># Convert both .mif files to temporary .nii.gz files with -force flag</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_file1</span><span class="p">,</span> \
     <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_file2</span><span class="p">:</span>
         
    <span class="c1"># Convert main image</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;mrconvert&quot;</span><span class="p">,</span> <span class="n">mif_file_path1</span><span class="p">,</span> <span class="n">temp_file1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;-force&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result1</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in mrconvert for preprocessed image: </span><span class="si">{</span><span class="n">result1</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>
    
    <span class="c1"># Convert overlay image</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;mrconvert&quot;</span><span class="p">,</span> <span class="n">mif_file_path2</span><span class="p">,</span> <span class="n">temp_file2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;-force&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result2</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in mrconvert for original image: </span><span class="si">{</span><span class="n">result2</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>
         
    <span class="c1"># Load the converted images</span>
    <span class="n">nii_image1</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">temp_file1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">nii_image2</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">temp_file2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">data1</span> <span class="o">=</span> <span class="n">nii_image1</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">nii_image2</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="c1"># Select middle slice </span>
    <span class="n">slice_index</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot original diffusion data as overlay</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">slice_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> 
    <span class="n">overlay</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">slice_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;hot&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Preprocessed data with original diffusion data as overlay&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/94da2c3fdf120f3f1903947767c0dec353ab446718821c5b123b9ae31089db21.png" src="../../_images/94da2c3fdf120f3f1903947767c0dec353ab446718821c5b123b9ae31089db21.png" />
</div>
</div>
<section id="dependencies-in-jupyter-python">
<h3>Dependencies in Jupyter/Python<a class="headerlink" href="#dependencies-in-jupyter-python" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Using the package <a class="reference external" href="https://github.com/rasbt/watermark">watermark</a> to document system environment and software versions used in this notebook</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark

<span class="o">%</span><span class="k">watermark</span>
<span class="o">%</span><span class="k">watermark</span> --iversions
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: 2025-11-06T02:30:05.908666+00:00

Python implementation: CPython
Python version       : 3.11.6
IPython version      : 8.16.1

Compiler    : GCC 12.3.0
OS          : Linux
Release     : 5.4.0-204-generic
Machine     : x86_64
Processor   : x86_64
CPU cores   : 32
Architecture: 64bit

matplotlib: 3.8.4
nibabel   : 5.3.2
numpy     : 2.2.4
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./examples/diffusion_imaging"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="MRtrix_3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MRtrix: Part 3</p>
      </div>
    </a>
    <a class="right-next"
       href="../electrophysiology/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Electrophysiology</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-and-resources">Citation and Resources:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-included-in-this-workflow">Tools included in this workflow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-software-tools-and-import-python-libraries">Load software tools and import python libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-mif-file">Convert to .mif file</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#denoising-and-gibbs-ringing-removal-unringing">Denoising and Gibbs ringing removal (“unringing”)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-and-distortion-correction">Motion and distortion correction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-field-correction">Bias field correction</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brain-mask-estimation">Brain mask estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-response-function-estimation">3-tissue response function estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upsampling">Upsampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-csd-modelling">3-tissue CSD modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tissue-bias-field-and-intensity-normalisation">3-tissue bias field and intensity normalisation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-computation">Temperature computation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-csf-mask">Get CSF mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-diffusion-coefficient-in-csf">Calculate diffusion coefficient in CSF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-estimation">Temperature estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>